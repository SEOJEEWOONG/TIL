# 운영체제론

> 작성 날짜 : 2021-11-30


**운영체제**

* 정의 : 시스템의 자원과 동작을 관리하는 소프트웨어
* 기능
    - 프로세스 관리 : 현재 CPU를 점유해야 할 프로세스 결정
        - 프로세스 간 통신 관리
        - 스케줄링
        - 동기화
        - IPC 통신 (Inner Process Communication)
    - 저장장치 관리 : 1차 저장장치(메인메모리)와 2차 저장장치(하드디스크) 관리하는 기능
        - 메모리 관리
        - 가상 메모리
        - 파일 시스템
        - 1차 저장장치
            - 프로세스에 할당하는 메모리 영역의 할당과 해제
            - 각 메모리 영역 간의 침범 방지
            - 메인 메모리의 효율적 활용을 위한 가상 메모리 기능
        - 2차 저장장치
            - 파일 형식의 데이터 저장
    - 네트워킹
        - TCP/IP
        - 기타 프로토콜
    - 사용자 관리
        - 계정 관리
        - 접근권한 관리
    - 디바이스 드라이버
        - 순차접근장치
        - 임의접근장치
        - 네트워크장치


**프로세스 & 스레드**

* 프로세스 : 운영체제로부터 자원을 할당받는 작업의 단위
* 스레드 : 프로세스 안에서 실행되는 여러 흐름 단위
    - 기본적으로 프로세스 하나에 메인 스레드 한개 존재
* 프로세스 메모리
    - compile time에 code, data, bss 데이터 크기가 결정되며 고정
        - Code : 코드 자체를 구성하는 메모리 영역 (프로그램 명령어 - 기계어)
        - Data : 전역변수, 배열, 초기화 된 데이터는 Data 영역에 저장
        - BSS : 초기화 되지 않은 변수
    - run time에 heap, stack 메모리 사용이 결정
        - Heap : 순차적으로 아래로 메모리 사용, 동적으로 할당된 변수]
        - Stack : 끝에서부터 위로 메모리 사용, 지역 변수
            - 스레드는 Stack만 할당받고 나머지 공유            
* 멀티 프로세스 : 하나의 컴퓨터에 하나 이상의 CPU 장착하여 여러 프로세스 동시에 처리
    - 장점
        - 메모리 침범 문제를 OS가 알아서 처리
        - 프로세스 중 하나에 문제 생겨도 다른 프로세스 영향 X
    - 단점
        - 각각 독립된 메모리 영역을 갖고 있어 작업량 많을 수록 오버헤드 큼
            - Context Switching으로 소모 자원 많음
                - Context Switching : 동작 중인 프로세스가 대기하면서 해당 프로세스의 상태를 보관하고 대기하고 있던 다음 순번의 프로세스 동작하면서 이전 프로세스 상태 복구
                - 프로세스는 각 독립된 메모리 영역을 할당받아 사용하므로 캐시 메모리 초기화와 같은 무거운 작업이 진행됨
* 멀티 스레드 : 하나의 응용 프로그램에서 여러 스레드를 구성해 각 스레드가 하나의 작업 처리
    - 장점
        - 독립적인 프로세스에 비해 공유 메모리만큼 자원 손실 감소
        - 전역변수와 정적변수 공유 가능
        - 프로세스를 생성하여 자원을 할당하는 시스템 콜이 줄어들어 효율적으로 관리 가능
        - 프로세스 간 통신보다 스레드 간의 통신 비용이 적으므로 작업들 간 통신 부담이 줄어든다.
    - 단점
        - 하나의 스레드가 데이터 공간 망가 뜨리면 모든 스레드 작동 불능
        - 하나의 스레드가 공유 데이터 값 변경 시점에 다른 스레드가 그 값을 읽으려 할 때 발생하는 문제를 해결하기 위한 동기화 과정 필요
* Process Management : CPU가 프로세스가 여러개일 때, CPU 스케줄링을 통해 관리하는 것
    - 프로세스 특징 : Process Metadata
        - Process Metadata는 Process 생성 시에 PCB에 저장
    - 프로세스 동작 과정
        1) 프로그램 실행
        2) 프로세스 생성
        3) 프로세스 주소 공간에 생성
        4) 프로세스 메타 데이터 PCB에 저장 (연결 리스트)
    - Context Switching : cpu가 프로세스 상태를 PCB에 저장하고 다른 프로세스 정보를 PCB에서 읽어 레지스터에 적재하는 과정
        - 인터럽트 발생시 동작
            - 인터럽트 : 실행 중인 CPU 허가 시간 모두 소모, 입출력 이벤트 발생
* IPC : 독립적으로 실행되는 프로세스끼리 통신해야하는 상황 (커널 제공하는 기능)
    - 익명 PIPE : 파이프는 두개의 프로세스 연결하는 데 사용되며 한쪽은 송신만 한쪽은 수신만 되는 파이프
    - Named PIPE : 부모 프로세승와 무관한 다른 프로세스 통신
    - Message Queue : 사용할 데이터에 번호 붙여서 사용할 수 있도록 하는 메모리 공간
    - 공유 메모리 : 공유 메모리는 데이터 자체를 공유하도록 지원하는 설비
    - 메모리 맵 : 열린 파일을 메모리에 맵핑 시켜서 공유
    - 소켓 : 네트워크 소켓 통신을 통해 데이터 공유
        - 서버 : bind, listen, accept, 클라이언트 : connect
    - 프로세스 간 데이터를 동기화하고 보호하기 위해 세마포어와 뮤텍스 사용


**데드락**
- 정의 : 프로세스가 자원을 얻지 못해서 다음 처리를 하지 못하는 상태로 교착 상태라고 부름 (프로세스는 공유 메모리를 통해 자원을 공유)
    - 서로 원하는 자원이 상대방에 할당되어 있어서 두 프로세스는 영원히  wait 상태
- 성립 요건
    - 상호 배제 : 자원은 한 번에 하나의 프로세스에서 사용
    - 점유 대기 : 최소한 하나의 자원을 점유하고 있으면서 다른 프로세스에 할당되어 있는 자원 대기
    - 비선점 : 프로세스에 할당된 자원은 사용이 끝날 때까지 뺏을 수 없음
    - 순환 대기 : 프로세스 집합에서 순환 형태로 대기(PO -> P1 -> P2 -> P0)
- 해결법
    - 예방 : 발생조건 4가지 중 하나라도 성립 못하도록 하는 것
        - 시스템의 처리량이나 효율성을 떨어뜨리는 단점
    - 회피 : 자원을 할당한 후에도 시스템이 안정 상태에 있도록 자원 할당
        - 미리 최대 자원 요구량을 알 수 없다
    - 탐지 및 회복
        - 탐지 : 현재 시스템의 자원 할당 상태를 가지고 파악
        - 회복 : 프로세스를 하나씩 중단시킬 때마다 탐지 알고리즘을로 데드락 탐지하면서 회복
        - 프로세스에 할당된 자원을 선점하면서 데드락 해결할 때까지 다른 프로세스에게 할당